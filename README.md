# QuorumOS

QuorumOS is a trusted computation layer for hosting secure apps at modern cloud scale. The OS architecture is based on the first principle that a threshold of members from a set can deem an enclave trustworthy and execute root system calls.

QuorumOS is designed to boot in an enclave by attesting to the enclave configuration, reconstructing a Quorum Key and then launching a single secure application that can leverage the Quorum Key to encrypt and authenticate data.

## System requirements

- openssl >= 1.1.0

## Development

### Submitting a PR

Before a PR can be merged it must:

Be formatted

```bash
make lint
```

And pass all tests

```bash
make test-all
```

### View the docs

In the root of this project run

```bash
cargo doc --open
```

## Conceptual

### Major Components

#### Enclave

- houses server for listening to the Host
- contains logic for quorum key genesis, booting, and running a Secure App
- see `qos_core`

#### Host

- EC2 instance housing the nitro enclave
- has client for talking to nitro enclave
- has server for incoming request from outside world
- see `qos_host`

#### End user

- anything making request to host
- see `qos_client`

### Key Terms

#### Quorum Key

An asymmetric key used to uniquely authenticate and encrypt data. This key should only ever be reconstituted inside of an enclave.

#### Quorum Member

An entity that is a member of the Quorum Set and holds a share of the Quorum Key.

#### Quorum Set

The collection of members whom each hold shares of the Quorum Key and can authorize certain QOS actions. A threshold of these members shares is required to reconstruct the Quorum Key

#### Personal Key

A key held by a Quorum Member that can be used to encrypt/decrypt their share of the Quorum Key.

### Personal Setup Key

A key held by a Quorum Member that can be used to encrypt secret data before a QuorumOS instance has been fully bootstrapped.

#### Ephemeral Key

An asymmetric key that is generated by a QuorumOS instance immediately after boot. Once Quorum Members are able to verify the integrity of a QuorumOS instance, they encrypt their Quorum Key shares to the Ephemeral Key and submit to the instance for reconstruction.

#### Manifest

A file that contains the static configuration to launch an instance of QuorumOS. The composition of the Manifest is attested to in the boot process. All Quorum Members will agree to the Manifest by signing it (QuorumOS should reject a submitted manifest if it has less the threshold signatures.)

#### Namespace

A group of QuorumOS nodes running the same Secure App and using the same Quorum Key. A Namespace can contain varying Manifests.

### Pivot / Secure App

The application QOS once it finishes booting. This application is identified in the Manifest file.

### Instance Provision

Immediately after a valid manifest file is loaded into QuorumOS, the instance will generate an Ephemeral Key. This key is specific to a particular individual machine and, after successfully verifying the machine image and metadata contained in the manifest file, will be used by the Quorum Members to post their shares into the machine.

Prior to posting their share to the machine, Quorum Members use a variety of cryptographic attestations and social coordination to determine if it is appropriate to provision a particular instance of QuorumOS with a given secret.

Upon successful verification of the attestation outputs, each member will encrypt their share to an Ephemeral Key. Once threshold shares have been collected by the instance, it will use Shamirâ€™s Secret Sharing to reconstruct the Quorum Key.

#### Remote Attestation

The purpose of remote attestation is to prove that an environment is running a particular piece of software. In the case of AWS Nitro Enclaves, an enclave can uniquely ask the Nitro Security Module (NSM) for an attestation document containing details of the enclave. This document is signed by the Nitro Attestation PKI and is tied back to the AWS Nitro Attestation PKI Root.

As defined in the [AWS documentation](https://docs.aws.amazon.com/enclaves/latest/user/verify-root.html) the instance can request the Nitro Security Module (NSM) to produce an attestation document on its behalf. Additionally, the attestation document contains two fields that can be modified by the enclave itself. The attestation document request contains the Ephemeral Key and the hash of manifest so Quorum Set members can verify the data is correct.

Before provisioning a namespace with the Quorum Key, a Quorum Set will use the output of the attestation process against the enclave to verify that the enclave is running the expected version of QuorumOS and that that instance is configured in the expected manner as to warrant being provisioned with that Quorum Key.
